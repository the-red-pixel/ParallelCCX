# SRFG-v1-X
> Stack Related Flow Graph (Revision 1) eXtension  
> 栈相关流图（第一修订版）扩展  

**（阅读此文档前，请确定您已知晓 Java 字节码相关的基础知识，并且已阅读 SRFG-v1 的相关文档）**


## 目录
- [1 概述](#1)
- [2 类型系统](#2)
    - [2.1 基本类型](#2-1)
    - [2.2 松散模型](#2-2)
    - [2.3 严格模型](#2-3)
- [3 图结构](#3)
    - [3.1 蕴含性](#3-1)
    - [3.2 基本表示](#3-2)
    - [3.3 基本单位](#3-3)

## <a id = "1">1&nbsp;概述</a>
&emsp;&emsp;**SRFG-v1-X** 是对于 **SRFG-v1** （栈相关流图第一修订版）的扩展版本，使第一修订版的 **SRFG** 更加适合于对于 Java 字节码的动态修改操作，支持更多的面向切面编程相关特性。在此 **SRFG** 版本中，将基于 **SRFGv1** 的大部分基础特性进行修改及扩展，所有相关的被修改的及扩展的特性都将在本文中进行详细的列举与解释。  


## <a id = "2">2&nbsp;类型系统</a>
&emsp;&emsp;**SRFG-v1-X** 与 **SRFG-v1** 对于类型的处理策略不同，**SRFG-v1-X** 中引入了较为完整、严格的类型系统以实现一些多态化的功能。此类型系统的规则与 Java 语言规范大致一致，但不考虑泛型的相应情况。  

### <a id = "2-1">2.1&nbsp;基本类型</a>
&emsp;&emsp;在本类型系统中，可以将 Java 的所有类型归类为以下几种类型，并且有对应的描述符，与 JVM 规范相仿：  

类型名称   | 描述符 | 类别 | 描述       |
--------- | ------ | --- | ---------- |
Integer   | I      |  1  | 32位整型数  |
Float     | F      |  1  | 32位浮点数  |
Long      | J      |  2  | 64位整型数  |
Double    | D      |  2  | 64位整型数  |
Reference | L      |  1  | 对象引用    |
Array     | [      |  1  | 数组引用    |

&emsp;&emsp;以上这些基本类型的分类对于最基本的堆栈推算与验证是必须的，这些类型又可以被分为两种类别，以表示其在堆栈的不同表示方式。区别在于第一类别的类型在堆栈内占用一个槽位，而第二类别的类型在堆栈内占用两个槽位。实际上 Java 内还有四种整型（```boolean```、```byte```、```char```、```short```），比已有的两种整型类型的精度都要低，它们之所以没有被列出来是因为它们在 JVM 的内存模型中表示方式都与32位整型数一致，只存在处理方式上的差别。  
&emsp;&emsp;以上这种基本类型分类方式在松散验证与对性能敏感的场景下是种不错的选择，但这明显不符合 **SRFG-v1-X** 的设计目标，这样松散、简单的分类方式是无法满足多态化的需求的。所以本类型系统将考虑所有的基本类型，并且对于对象引用、数组引用的类型计算会有更加复杂的实现。基本类型分类情况如下表:

类型名称   | 描述符 | 类别 | 描述                 |
--------- | ------ | --- | -------------------- |
Boolean   | Z      |  1  | 布尔类型（1位整型数）  |
Byte      | B      |  1  | 字节类型（8位整型数）  |
Char      | C      |  1  | 字符类型（16位整型数） |
Short     | S      |  1  | 16位整型数            |
Integer   | I      |  1  | 32位整型数            |
Float     | F      |  1  | 32位浮点数            |
Long      | J      |  2  | 64位整型数            |
Double    | D      |  2  | 64位整型数            |
Reference | L      |  1  | 对象引用              |
Array     | [      |  1  | 数组引用              |

### <a id = "2-2">2.2&nbsp;松散模型</a>



### <a id = "2-3">2.3&nbsp;严格模型</a>
// TODO
  

## <a id = "3">3&nbsp;图结构</a>

### <a id = "3-1">3.1&nbsp;蕴含性</a>

### <a id = "3-2">3.2&nbsp;基本表示</a>
&emsp;&emsp;**SRFG-v1-X** 结构的基本表示相关的规则与 **SRFG-v1** （栈相关流第一修订版） 相同，详见 **SRFG-v1** 相关文档。

### <a id = "3-3">3.3&nbsp;基本单位</a>
&emsp;&emsp;**SRFG-v1-X** 中对于 **SRFG-v1** 的原有的基本节点单位进行了扩展，并且对于原有的基本节点单位没有删减，本节将对这些扩展的内容进行详细介绍。  
